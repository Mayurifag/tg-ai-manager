{% extends "base.html" %}

{% block title %}Telegram Manager{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="/static/css/index_styles.css">
{% endblock %}

{% block content %}
<h1>Chats</h1>
<div class="chat-list">
    {% for chat in chats %}

    {% set link = "/chat/" ~ chat.id %}
    {% if chat.type.value == 'forum' %}
    {% set link = "/forum/" ~ chat.id %}
    {% endif %}

    <a href="{{ link }}" class="chat-card">
        <div class="chat-content">
            {% if chat.image_url %}
            <img src="{{ chat.image_url }}" class="avatar" alt="Avatar">
            {% else %}
            <div class="avatar">{{ chat.name[0] | upper }}</div>
            {% endif %}

            <div class="chat-info">
                <div class="chat-header">
                    <span class="chat-name" title="{{ chat.name }}">{{ chat.name }}</span>
                    <span class="badge">{{ chat.type.value }}</span>
                </div>
                <div class="preview">
                    {{ chat.last_message_preview or 'No messages' }}
                </div>
            </div>
        </div>

        <div class="meta">
            {% if chat.unread_count > 0 %}
            <div class="unread">
                {% if chat.type.value == 'forum' and chat.unread_topics_count is not none and
                chat.unread_topics_count > 0 %}
                {{ chat.unread_count }} ({{ chat.unread_topics_count }} topics)
                {% else %}
                {{ chat.unread_count }}
                {% endif %}
            </div>
            {% endif %}
        </div>
    </a>
    {% endfor %}
</div>
{% endblock %}
