{% extends "base.html" %}

{% block title %}
{% if chat %}
{{ chat.name }}
{% else %}
Messages
{% endif %}
{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="/static/css/chat_styles.css?v={{ range(1, 10000) | random }}">
{% endblock %}

{% block content %}
<div class="header">
    <a href="javascript:history.back()" class="back-link">‚Üê Back</a>
    {% if chat %}
    <span style="font-weight: bold; margin-left: 10px;">{{ chat.name }}</span>
    {% endif %}
</div>

<div class="messages-container">
    {% for msg in messages %}
    <div class="message-row {{ 'outgoing' if msg.is_outgoing else 'incoming' }}">
        {% if not msg.is_outgoing %}
        <div class="message-avatar"
            style="width: 35px; height: 35px; min-width: 35px; margin-right: 8px; border-radius: 50%; overflow: hidden; flex-shrink: 0;">
            {% if msg.avatar_url %}
            <img src="{{ msg.avatar_url }}" alt="{{ msg.sender_initials }}"
                style="width: 100%; height: 100%; object-fit: cover; display: block;">
            {% else %}
            <div class="avatar-placeholder"
                style="background-color: {{ msg.sender_color or '#ccc' }}; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold; text-transform: uppercase;">
                {{ msg.sender_initials or '?' }}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="message-bubble">
            {% if not msg.is_outgoing and msg.sender_name %}
            <span class="sender">{{ msg.sender_name }}</span>
            {% endif %}
            <div class="text">{{ msg.text | safe }}</div>
            <div class="time">{{ msg.date.strftime('%H:%M') }}</div>
        </div>
    </div>
    {% endfor %}
</div>

<script>
    window.scrollTo(0, document.body.scrollHeight);
</script>
{% endblock %}
